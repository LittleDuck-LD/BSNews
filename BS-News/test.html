<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="favicon.ico" sizes="16x16">
    <title>Brawl Stars Inbox</title>
</head>
<body>
    <a id="openLink" href="#">Open Brawl Stars Inbox</a>
    <button id="debugButton">Debug</button>
    <div id="responseContainer"></div>

    <script>
        const openLink = document.getElementById('openLink');
        const debugButton = document.getElementById('debugButton');
        const responseContainer = document.getElementById('responseContainer');
        let timeoutId = null;

        function openSchemeLink() {
            return new Promise((resolve, reject) => {
                const schemeLink = 'brawlstars-inbox://getParams';

                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = schemeLink;
                document.body.appendChild(iframe);

                // Set a timeout to remove the iframe after a short duration
                setTimeout(() => {
                    document.body.removeChild(iframe);
                    resolve();
                }, 100);
            });
        }

        function handleClientResponse(response) {
            clearTimeout(timeoutId);
            responseContainer.innerHTML = `Client Response: <strong>${response}</strong>`;
        }

        openLink.addEventListener('click', async (event) => {
            event.preventDefault();

            clearTimeout(timeoutId);
            responseContainer.innerHTML = '';

            try {
                await openSchemeLink();

                timeoutId = setTimeout(() => {
                    responseContainer.innerHTML = 'Timeout: No response from client.';
                }, 3000);
            } catch (error) {
                console.error('Error:', error);
                responseContainer.innerHTML = `Error: ${error}`;
            }
        });

        debugButton.addEventListener('click', () => {
            const debugResponse = 'Debug response from client';
            handleClientResponse(debugResponse);
        });
    </script>
</body>
</html>
